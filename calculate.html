<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB R2019b"><title>Calculations script for motors coursework</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S2 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 4px; padding: 6px 45px 4px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S3 { margin: 20px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.S4 { margin: 15px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.S5 { margin: 10px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 15px; font-weight: 700; text-align: left;  }
.S6 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S7 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 16.996px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S9 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span style=' font-weight: bold;'>Calculations script for motors coursework</span></h1><div  class = 'S1'><span style=' font-weight: bold;'>Takes input in form of motors table to select most sutable motor</span></div><div  class = 'S1'><span>USE: Use load("motorsTable.mat") before running the script, and pass it as an input. If selecting a motor, comment out line 37 through 78.</span></div><div  class = 'S1'><span>To calculate torque requirements of system based on inertia, comment out line 2!</span></div><div  class = 'S1'><span style=' font-style: italic;'>Callum Morrison, 2019</span></div><div  class = 'S1'><span style=' font-style: italic;'></span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">function </span><span>[accelTorque, decelTorque, torqueRMS] = calculate(mt)</span></span></div></div></div><h2  class = 'S3'><span>VARIABLES</span></h2><h3  class = 'S4'><span>INERTIA</span></h3><h4  class = 'S5'><span>Rotors</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% D, d / m</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% m / kg</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Driving roller radius</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">r</span><span> = </span></span><span>0.075</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Driving Roller</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">D</span><span>(1) = </span></span><span>0.15</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">d</span><span>(1) = </span></span><span>0.15</span><span style="white-space: pre;"><span>; </span><span style="color: rgb(60, 118, 61);">%% Same as D if unknown</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">m</span><span>(1) = </span></span><span>3.57</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Driven Roller</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">D</span><span>(2) = </span></span><span>0.15</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">d</span><span>(2) = </span></span><span>0.15</span><span style="white-space: pre;"><span>; </span><span style="color: rgb(60, 118, 61);">%% Same as D if unknown</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">m</span><span>(2) = </span></span><span>3.57</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Tension Roller</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">D</span><span>(3) = </span></span><span>0.1</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">d</span><span>(3) = </span></span><span>0.1</span><span style="white-space: pre;"><span>; </span><span style="color: rgb(60, 118, 61);">%% Same as D if unknown</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">m</span><span>(3) = </span></span><span>2.04</span><span style="white-space: pre;"><span>;</span></span></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Linear momentum</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% mL / kg</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Belt</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">mL</span><span>(1) = </span></span><span>25.48</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Box full</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>mL(2) = </span></span><span>7.645</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Box empty</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% </span><span class="nonlocalVariableHighlighting" style="color: rgb(60, 118, 61);">mL</span><span style="color: rgb(60, 118, 61);">(2) = </span></span><span style="color: rgb(60, 118, 61);">0.545</span><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">;</span></span></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Gear ratios for two stage gearbox</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Stage 1 (closest to motor)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>gr1 = </span></span><span>4.71</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Stage 2 (closest to output shaft)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>gr2 = </span></span><span>4.5</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Gear ratio (overall)</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">gr</span><span> =  gr1 * gr2;</span></span></div></div></div><div  class = 'S9'><span></span></div><h4  class = 'S5'><span>Constant sources of inertia (gearbox, bearings, pulleys etc)</span></h4><div  class = 'S1'><span>Divide as necessary by gear ratios </span><span style=' font-weight: bold;'>squared</span><span> to determine inertia seen by motor!</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Key:</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST0   |   Inertia at motor; not affected by gear ratio</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST1   |   Inertia after stage 1; affected by gr1 only</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST2   |   Inertia after stage 2; affected by gt1 and gr2 (total gear ratio)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% iC / kgm^2</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST0 | Stage 1 Driving Pulley</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(1) = 2.92e-7;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST1 | Stage 1 Driven Pulley</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(2) = 4.25e-5 / gr1^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST1 | Stage 2 Driving Pulley</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(3) = 1.12e-6 / gr1^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST2 | Stage 2 Driven Pulley</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(4) = 2.37e-4 / </span><span class="nonlocalVariableHighlighting">gr</span><span>^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST2 | 12mm Output Shaft</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(5) = 5.59e-6 / </span><span class="nonlocalVariableHighlighting">gr</span><span>^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST1 | 6-8mm Intermediate Shaft</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(6) = 1.85e-7 / gr1^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST1 | 6mm Ball Bearing</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(7) = 6.48e-8 / gr1^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST1 | 8mm Ball Bearing</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(8) = 1.92e-7 / gr1^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST2 | 12mm Ball Bearing</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(9) = 5.10e-7 / </span><span class="nonlocalVariableHighlighting">gr</span><span>^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST0 | 3mm Timing Belt</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(10) = 3.87e-5;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST1 | 5mm Timing Belt</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(11) = 1.84e-4 / gr1^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% ST0 | Motor</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">iC</span><span>(12) = 3.67e-4;</span></span></div></div></div><h2  class = 'S3'><span></span></h2><h3  class = 'S4'><span>FRICTION</span></h3><h4  class = 'S5'><span>Constant linear</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% f / N</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Belt</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">f</span><span>(1) = </span></span><span>250</span><span style="white-space: pre;"><span>;</span></span></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Constant rotary</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% tC / Nm</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Nothing here</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'></div></div></div><h3  class = 'S4'><span></span></h3><h3  class = 'S4'><span>VELOCITY PROFILE</span></h3><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Max speed of driving rotor v = r * omega</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>linmax = </span></span><span>1</span><span style="white-space: pre;"><span>; </span><span style="color: rgb(60, 118, 61);">% v       % ms^-1</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Distance required to travel cycle length / m</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>travelDist = </span></span><span>1.5</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Acceleration time / s</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>accelTime = </span></span><span>0.75</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Deceleration time / s</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>decelTime = </span></span><span>0.75</span><span style="white-space: pre;"><span>;</span></span></div></div></div><div  class = 'S9'><span></span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% --- DO NOT EDIT ---</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Calculates distance traveled while accelerating and decelerating</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>variableSpeedDist = (linmax / 2 * accelTime) + (linmax / 2 * decelTime);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Calculates time required at max speed to reach travel dist</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>timeConstSpeed = (travelDist - variableSpeedDist) / linmax;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">vmaxrad</span><span> = linmax / </span><span class="nonlocalVariableHighlighting">r</span><span>; </span><span style="color: rgb(60, 118, 61);">% omega            % rads^-1</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>vmax = </span><span class="nonlocalVariableHighlighting">vmaxrad</span><span> * 60 / (2 * pi());        </span><span style="color: rgb(60, 118, 61);">% rpm</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>clear </span><span style="color: rgb(160, 32, 240);">linmax</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Time variables in the form</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% [startAccel, stopAccel, startDecel, stopDecel]</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Assumes trapezoidal profile!</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>t = [0 accelTime accelTime + timeConstSpeed accelTime + timeConstSpeed + decelTime];</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% -------------------</span></span></div></div></div><h3  class = 'S4'><span></span></h3><h3  class = 'S4'><span>SAFETY FACTOR</span></h3><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Design safety factor</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">sf</span><span> = </span></span><span>1.3</span><span style="white-space: pre;"><span>;</span></span></div></div></div><h3  class = 'S4'><span></span></h3><h3  class = 'S4'><span>TRANSMISSION EFFICIENCY</span></h3><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Mechanical efficiency of the transmission from 0-1 (0% to 100% efficient)</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>mechEfficiency = </span></span><span>0.95*0.95</span><span style="white-space: pre;"><span>;</span></span></div></div></div><div  class = 'S9'><span></span></div><h2  class = 'S3'><span>END OF VARIABLES</span></h2><div  class = 'S1'><span></span></div><div  class = 'S1'><span></span></div><h4  class = 'S5'><span>Output separator</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>sz = get(0, </span><span style="color: rgb(160, 32, 240);">'CommandWindowSize'</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">br</span><span> = </span><span style="color: rgb(160, 32, 240);">"\n" </span><span>+ join(repmat(</span><span style="color: rgb(160, 32, 240);">"-"</span><span>, sz(1), 1), </span><span style="color: rgb(160, 32, 240);">""</span><span>) + </span><span style="color: rgb(160, 32, 240);">"\n\n"</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>clear </span><span style="color: rgb(160, 32, 240);">sz</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Check for input table</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">if </span><span>~exist(</span><span style="color: rgb(160, 32, 240);">"mt"</span><span>, </span><span style="color: rgb(160, 32, 240);">"var"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"No motors table detected, skipping straight to inertia calculations! " </span><span>+ </span><span style="color: rgb(0, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(160, 32, 240);">"If this is not desired, please use form 'calculate(motorsTable)' \n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    skipMotors = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    skipMotors = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Initialise nested variables</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">inertiaAtMotor</span><span> = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">constTorque</span><span> = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">power</span><span> = 0;</span></span></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Calculate gear ratio for all motors</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">if </span><span>~exist(</span><span style="color: rgb(160, 32, 240);">"gr"</span><span>, </span><span style="color: rgb(160, 32, 240);">"var"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">if </span><span>skipMotors</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        error(</span><span style="color: rgb(160, 32, 240);">"No motors table has been supplied - you must provide gear ratio"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"Gear ratio has not been supplied... calculating based on max motor RPM\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span class="warning_squiggle_rte">grSupplied</span><span> = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"Calculating required motor gear ratios\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span class="nonlocalVariableHighlighting">gr</span><span> = </span><span class="warning_squiggle_rte">mt</span><span>.(</span><span style="color: rgb(160, 32, 240);">"rpm"</span><span>) ./ vmax;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"Done!\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Convert inertia for all motors</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">if </span><span>~skipMotors</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"Converting motor table inertia from kgcm^2 to kgm^2... \n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    mt.(</span><span style="color: rgb(160, 32, 240);">"inertia"</span><span>)(:) = mt.(</span><span style="color: rgb(160, 32, 240);">"inertia"</span><span>)(:) / 10000;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"Done!\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Basic Power Calculation</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre;"><span>powerCalc</span></span></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Motor Selection</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">if </span><span>~skipMotors</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    motorSuitable = zeros(height(mt), 1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(60, 118, 61);">% Loop through all motors</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">for </span><span class="nonlocalVariableHighlighting warning_squiggle_rte">x</span><span> = 1:height(mt)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">"Testing motor %d\n"</span><span>, </span><span class="nonlocalVariableHighlighting">x</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span class="warning_squiggle_rte">motorPower</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>) = mt.(</span><span style="color: rgb(160, 32, 240);">"rpm"</span><span>)(</span><span class="nonlocalVariableHighlighting">x</span><span>) * 2 * pi() / 60 * mt.(</span><span style="color: rgb(160, 32, 240);">"torqueStall"</span><span>)(</span><span class="nonlocalVariableHighlighting">x</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">"Using motor speed of %.0frpm \n"</span><span>, mt.(</span><span style="color: rgb(160, 32, 240);">"rpm"</span><span>)(</span><span class="nonlocalVariableHighlighting">x</span><span>))</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">"Using motor stall torque of %.2fNm \n"</span><span>, mt.(</span><span style="color: rgb(160, 32, 240);">"torqueStall"</span><span>)(</span><span class="nonlocalVariableHighlighting">x</span><span>))</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">if </span><span>motorPower(</span><span class="nonlocalVariableHighlighting">x</span><span>) &gt; </span><span class="nonlocalVariableHighlighting">power</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span style="color: rgb(160, 32, 240);">"SUCCESS: Motor (%dW) IS more powerful than required power %dW \n"</span><span>, round(motorPower(</span><span class="nonlocalVariableHighlighting">x</span><span>)), </span><span class="nonlocalVariableHighlighting">power</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            motorSuitable(</span><span class="nonlocalVariableHighlighting">x</span><span>) = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">elseif </span><span>motorPower(</span><span class="nonlocalVariableHighlighting">x</span><span>) &lt;= </span><span class="nonlocalVariableHighlighting">power</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span style="color: rgb(160, 32, 240);">"ERROR: Motor (%dW) IS NOT powerful enough (required %dW) \n"</span><span>, round(motorPower(</span><span class="nonlocalVariableHighlighting">x</span><span>)), </span><span class="nonlocalVariableHighlighting">power</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            motorSuitable(</span><span class="nonlocalVariableHighlighting">x</span><span>) = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">if </span><span>motorSuitable ~= 1</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        error(</span><span style="color: rgb(160, 32, 240);">"No suitable motors!"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"%d motors are suitable from the table of %d\n"</span><span>, sum(motorSuitable), height(mt))</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>    fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div></div><div  class = 'S9'><span></span></div><h4  class = 'S5'><span>Gearbox Calculations</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"WARNING!\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"Gear ratio was not supplied in variables\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"The function will now end\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"Please select a suitable gearbox and related components, and populate variables\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"For reference, power transmission requirement is %dW\n"</span><span>, </span><span class="nonlocalVariableHighlighting">power</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"Remember: REAL GEAR RATIO MUST BE LESS THAN OR EQUAL TO THAT STATED HERE\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"In this case, the motor will just run slightly slower than full speed to reach target belt velocity\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"Gear ratios for suitable motors are as follows:\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"   MOTOR POWER / W    GR          Frq\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(60, 118, 61);">% Selects only gear ratios of suitable motors</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    gearRatios = round(</span><span class="nonlocalVariableHighlighting">gr</span><span>(</span><span class="warning_squiggle_rte warningHighlight">find</span><span>(motorSuitable)));</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(60, 118, 61);">% Displays gear ratios alongside their motor's power and frequency of</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(60, 118, 61);">% gr</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    disp([transpose(round(motorPower(</span><span class="warning_squiggle_rte warningHighlight">find</span><span>(motorSuitable)))), gearRatios, transpose(sum(gearRatios==gearRatios'))]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    fprintf(</span><span style="color: rgb(160, 32, 240);">"It is recommended you select gear ratios for motors with the lowest power; in order to prevent over-design\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    error(</span><span style="color: rgb(160, 32, 240);">"Function finished successfully"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Inertia Calculations</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S2'><span style="white-space: pre;"><span>inertiaCalc</span></span></div></div></div><div  class = 'S9'><span></span></div><h4  class = 'S5'><span>Calculate non-steady state torque</span></h4><div  class = 'S1'><span>Constant torque due to friction is assumed to be 100% at any speed - as this is worst case scenario</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">"Assume constant torque %dNm is 100%% at any speed!\n\n"</span><span>, </span><span class="nonlocalVariableHighlighting">constTorque</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">"Using inertia at motor as %dkgm^2\n"</span><span>, </span><span class="nonlocalVariableHighlighting">inertiaAtMotor</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">"Mechanical efficiency is set as %d"</span><span>, mechEfficiency)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Convert constant torque to torque on side of motor</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">constTorque</span><span> = </span><span class="nonlocalVariableHighlighting">constTorque</span><span> / </span><span class="nonlocalVariableHighlighting">gr</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Convert max vmaxrad from after transmission to before transmission (same</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% side as motor)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span class="nonlocalVariableHighlighting">vmaxrad</span><span> = </span><span class="nonlocalVariableHighlighting">vmaxrad</span><span> * </span><span class="nonlocalVariableHighlighting">gr</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Convert vmax from after transmission to before transmission</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>vmax = vmax * </span><span class="nonlocalVariableHighlighting">gr</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Case 1: Acceleration</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>dt = t(2) - t(1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">"Acceleration: change in angular velocity of %drads^-1 in %ds \n"</span><span>, </span><span class="nonlocalVariableHighlighting">vmaxrad</span><span>, dt)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>accelTorque = (</span><span class="nonlocalVariableHighlighting">constTorque</span><span> + </span><span class="nonlocalVariableHighlighting">inertiaAtMotor</span><span> * (</span><span class="nonlocalVariableHighlighting">vmaxrad</span><span> / dt)) / mechEfficiency;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">"Required acceleration torque calculated as %dNm \n"</span><span>, accelTorque)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Case 2: Deceleration</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>dt = t(4) - t(3);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">"Deceleration: change in angular velocity of -%drads^-1 in %ds \n"</span><span>, </span><span class="nonlocalVariableHighlighting">vmaxrad</span><span>, dt)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>decelTorque = (</span><span class="nonlocalVariableHighlighting">constTorque</span><span> + </span><span class="nonlocalVariableHighlighting">inertiaAtMotor</span><span> * (-</span><span class="nonlocalVariableHighlighting">vmaxrad</span><span> / dt)) / mechEfficiency;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">"Required deceleration torque calculated as %dNm \n"</span><span>, decelTorque)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'></div></div></div><h4  class = 'S5'><span></span></h4><h4  class = 'S5'><span>Calculate RMS Torque</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">% Calculate RMS torque, where Tcycle = t(4)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>torqueRMS = sqrt(1 / t(4) * (t(2) * accelTorque^2 + (t(3) - t(2)) * </span><span class="nonlocalVariableHighlighting">constTorque</span><span>^2 + (t(4) - t(3)) * decelTorque ) );</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(160, 32, 240);">"RMS Torque calculated as %d\n"</span><span>, torqueRMS)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div></div><div  class = 'S9'><span></span></div><h4  class = 'S5'><span>Plot motor speed against torque requirements</span></h4><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>hold </span><span style="color: rgb(160, 32, 240);">on</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>yyaxis </span><span style="color: rgb(160, 32, 240);">left</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>plot(t, [0 vmax vmax 0])</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>ylabel(</span><span style="color: rgb(160, 32, 240);">"Motor Speed / rpm"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>yyaxis </span><span style="color: rgb(160, 32, 240);">right</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>xlim([t(1) t(end)])</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>ylim([min([accelTorque, </span><span class="nonlocalVariableHighlighting">constTorque</span><span>, decelTorque, torqueRMS, 0]) * 1.1, max([accelTorque, </span><span class="nonlocalVariableHighlighting">constTorque</span><span>, decelTorque, torqueRMS]) * 1.1])</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>line([t(2), t(2)], </span><span class="warning_squiggle_rte">[</span><span>get(gca, </span><span style="color: rgb(160, 32, 240);">"YLim"</span><span>)], </span><span style="color: rgb(160, 32, 240);">'Color'</span><span>, </span><span style="color: rgb(160, 32, 240);">'#333333'</span><span>, </span><span style="color: rgb(160, 32, 240);">'LineStyle'</span><span>,</span><span style="color: rgb(160, 32, 240);">'-.'</span><span>, </span><span style="color: rgb(160, 32, 240);">'HandleVisibility'</span><span>,</span><span style="color: rgb(160, 32, 240);">'off'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>line([t(3), t(3)], </span><span class="warning_squiggle_rte">[</span><span>get(gca, </span><span style="color: rgb(160, 32, 240);">"YLim"</span><span>)], </span><span style="color: rgb(160, 32, 240);">'Color'</span><span>, </span><span style="color: rgb(160, 32, 240);">'#333333'</span><span>, </span><span style="color: rgb(160, 32, 240);">'LineStyle'</span><span>,</span><span style="color: rgb(160, 32, 240);">'-.'</span><span>, </span><span style="color: rgb(160, 32, 240);">'HandleVisibility'</span><span>,</span><span style="color: rgb(160, 32, 240);">'off'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>plot([t(1) t(2) t(2) t(3) t(3) t(4)], [accelTorque accelTorque </span><span class="nonlocalVariableHighlighting">constTorque</span><span> </span><span class="nonlocalVariableHighlighting">constTorque</span><span> decelTorque decelTorque])</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>plot([0, t(end)], [torqueRMS, torqueRMS], </span><span style="color: rgb(160, 32, 240);">"r"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>legend([</span><span style="color: rgb(160, 32, 240);">"Motor Speed / rpm"</span><span>, </span><span style="color: rgb(160, 32, 240);">"Required Torque / Nm"</span><span>, </span><span style="color: rgb(160, 32, 240);">"RMS Torque / Nm"</span><span>])</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>xlabel(</span><span style="color: rgb(160, 32, 240);">"time / s"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>ylabel(</span><span style="color: rgb(160, 32, 240);">"Motor Torque / Nm"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>grid </span><span style="color: rgb(160, 32, 240);">minor</span></span></div></div></div><h2  class = 'S3'><span></span></h2><h2  class = 'S3'><span>NESTED FUNCTIONS</span></h2><h3  class = 'S4'><span>Inertia Calculations</span></h3><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">function </span><span>inertiaCalc</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        inertia = [];</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span style="color: rgb(60, 118, 61);">        %% Constant for all motors and gear ratios</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(60, 118, 61);">% For rotors</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">if </span><span>exist(</span><span style="color: rgb(160, 32, 240);">'D'</span><span>,</span><span style="color: rgb(160, 32, 240);">'var'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span><span style="color: rgb(0, 0, 255);">for </span><span class="nonlocalVariableHighlighting warning_squiggle_rte">x</span><span> = 1:1:size(</span><span class="nonlocalVariableHighlighting">D</span><span>,2)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"Rotor no. " </span><span>+ </span><span class="nonlocalVariableHighlighting">x</span><span> + </span><span style="color: rgb(160, 32, 240);">" uses variables:\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"D = %d \n"</span><span>, </span><span class="nonlocalVariableHighlighting">D</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>))</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"d = %d \n"</span><span>, </span><span class="nonlocalVariableHighlighting">d</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>))</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"m = %d \n"</span><span>, </span><span class="nonlocalVariableHighlighting">m</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>))</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span><span style="color: rgb(60, 118, 61);">% 'inertia' variable is affected by gearbox</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span><span class="warning_squiggle_rte">inertia</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>) = inertiaRotor(</span><span class="nonlocalVariableHighlighting">D</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>), </span><span class="nonlocalVariableHighlighting">d</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>), </span><span class="nonlocalVariableHighlighting">m</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>));</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"Inertia for rotor %d was calculated as %d kgms^2\n"</span><span>, </span><span class="nonlocalVariableHighlighting">x</span><span>, inertia(</span><span class="nonlocalVariableHighlighting">x</span><span>))</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span style="color: rgb(160, 32, 240);">"No rotors detected... continuing\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(60, 118, 61);">% For linear inertia</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">if </span><span>exist(</span><span style="color: rgb(160, 32, 240);">'mL'</span><span>,</span><span style="color: rgb(160, 32, 240);">'var'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span><span style="color: rgb(0, 0, 255);">for </span><span class="nonlocalVariableHighlighting warning_squiggle_rte">x</span><span> = 1:1:size(</span><span class="nonlocalVariableHighlighting">mL</span><span>,2)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"Linear 'inertia' source found: m = " </span><span>+ </span><span class="nonlocalVariableHighlighting">mL</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>) + </span><span style="color: rgb(160, 32, 240);">"kg\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"Using driving radius: %d\n"</span><span>, </span><span class="nonlocalVariableHighlighting">r</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"Converting to inertia: I = %.2dkgms^2\n"</span><span>, </span><span class="nonlocalVariableHighlighting">mL</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>) * </span><span class="nonlocalVariableHighlighting">r</span><span>^2)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span><span style="color: rgb(60, 118, 61);">% Approximate linear inertia as point mass at driven roller radius</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span><span style="color: rgb(60, 118, 61);">% I = mr^2</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span><span style="color: rgb(60, 118, 61);">% 'inertia' variable is affected by gearbox</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span><span class="warning_squiggle_rte">inertia</span><span> = [inertia, </span><span class="nonlocalVariableHighlighting">mL</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>) * </span><span class="nonlocalVariableHighlighting">r</span><span>^2];</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span style="color: rgb(160, 32, 240);">"No linear 'inertia' sources detected... continuing\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(60, 118, 61);">% Calculate inertia before and after bearbox (just noticed this misspelling but I'm keeping it)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">'Converting inertia after gearbox to inertia before gearbox...\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        inertia = sum(inertia);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">'Total inertia after gearbox (opposite side to motor) calculated as %dkgm^s\n'</span><span>, inertia)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span class="nonlocalVariableHighlighting">inertiaAtMotor</span><span> = inertia / </span><span class="nonlocalVariableHighlighting">gr</span><span>^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(60, 118, 61);">% Additional inertia sources (i.e. transmission inertia)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">if </span><span>exist(</span><span style="color: rgb(160, 32, 240);">'iC'</span><span>,</span><span style="color: rgb(160, 32, 240);">'var'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span><span style="color: rgb(0, 0, 255);">for </span><span class="nonlocalVariableHighlighting warning_squiggle_rte">x</span><span> = 1:1:size(</span><span class="nonlocalVariableHighlighting">iC</span><span>,2)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"Constant inertia source found: i = %d kgms^2 \n"</span><span>, </span><span class="nonlocalVariableHighlighting">iC</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>))</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">'This will not be affected by gear ratio!\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">'Ensure you have already divided by suitable gear ratios in the variables list!\n'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span><span class="nonlocalVariableHighlighting">inertiaAtMotor</span><span> = </span><span class="nonlocalVariableHighlighting">inertiaAtMotor</span><span> + </span><span class="nonlocalVariableHighlighting">iC</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span style="color: rgb(160, 32, 240);">"No constant inertia sources detected... continuing\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">"--- TOTAL INERTIA ---\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">"Total inertia at motor = %d kgms^2\n"</span><span>, </span><span class="nonlocalVariableHighlighting">inertiaAtMotor</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div></div><h2  class = 'S3'><span></span></h2><h3  class = 'S4'><span>Power Calculations</span></h3><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">function </span><span>powerCalc</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(60, 118, 61);">% Check for constant linear friction, convert to torque</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span class="nonlocalVariableHighlighting">constTorque</span><span> = [];</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">if </span><span>exist(</span><span style="color: rgb(160, 32, 240);">'f'</span><span>, </span><span style="color: rgb(160, 32, 240);">'var'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span><span style="color: rgb(0, 0, 255);">for </span><span class="nonlocalVariableHighlighting warning_squiggle_rte">x</span><span> = 1:1:size(</span><span class="nonlocalVariableHighlighting">f</span><span>,2)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"Constant linear force found: f = " </span><span>+ </span><span class="nonlocalVariableHighlighting">f</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>) + </span><span style="color: rgb(160, 32, 240);">"N\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span><span class="nonlocalVariableHighlighting">constTorque</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>) = linearToRotary(</span><span class="nonlocalVariableHighlighting">f</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>),</span><span class="nonlocalVariableHighlighting">r</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>));</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"Constant torque for constant force " </span><span>+ </span><span class="nonlocalVariableHighlighting">x</span><span> + </span><span style="color: rgb(160, 32, 240);">" was calculated as " </span><span>+ </span><span class="nonlocalVariableHighlighting">constTorque</span><span>(</span><span class="nonlocalVariableHighlighting">x</span><span>) + </span><span style="color: rgb(160, 32, 240);">"Nm\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span style="color: rgb(160, 32, 240);">"No constant linear force detected... continuing\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(60, 118, 61);">% Check for constant torque friction</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">if </span><span>exist(</span><span style="color: rgb(160, 32, 240);">'tC'</span><span>, </span><span style="color: rgb(160, 32, 240);">'var'</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span><span style="color: rgb(0, 0, 255);">for </span><span class="nonlocalVariableHighlighting warning_squiggle_rte">x</span><span> = 1:1:size(tC,2)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span style="color: rgb(160, 32, 240);">"Constant torque found: t = " </span><span>+ tC(</span><span class="nonlocalVariableHighlighting">x</span><span>) + </span><span style="color: rgb(160, 32, 240);">"Nm\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span><span class="warning_squiggle_rte nonlocalVariableHighlighting">constTorque</span><span> = [</span><span class="nonlocalVariableHighlighting">constTorque</span><span>, tC(</span><span class="nonlocalVariableHighlighting">x</span><span>)];</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>                fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">else</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span style="color: rgb(160, 32, 240);">"No constant linear force detected... continuing\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(60, 118, 61);">% Throw error if no friction (power would be zero)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">if </span><span>~exist(</span><span style="color: rgb(160, 32, 240);">"constTorque"</span><span>,</span><span style="color: rgb(160, 32, 240);">"var"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>            error(</span><span style="color: rgb(160, 32, 240);">"No constant torque calculated... something went wrong\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(60, 118, 61);">% Sum all torque values</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span class="nonlocalVariableHighlighting">constTorque</span><span> = sum(</span><span class="nonlocalVariableHighlighting">constTorque</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(60, 118, 61);">% Calculate total power required.</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span style="color: rgb(60, 118, 61);">% Gear ratio is irrelevant here</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">"Calculating power required to drive load\n"</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">"Constant torque after gearbox (opposite side to motor) calculated as %.2dNm\n"</span><span>, </span><span class="nonlocalVariableHighlighting">constTorque</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">"Rotational velocity of load is %.2d rads^-1\n"</span><span>, </span><span class="nonlocalVariableHighlighting">vmaxrad</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span class="nonlocalVariableHighlighting">power</span><span> = </span><span class="nonlocalVariableHighlighting">vmaxrad</span><span> * </span><span class="nonlocalVariableHighlighting">constTorque</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">"Initial required power = %.2fW \n"</span><span>, </span><span class="nonlocalVariableHighlighting">power</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span><span class="nonlocalVariableHighlighting">power</span><span> = </span><span class="nonlocalVariableHighlighting">power</span><span> * </span><span class="nonlocalVariableHighlighting">sf</span><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span style="color: rgb(160, 32, 240);">"Using a safety factor of %.2f, motor power becomes %dW\n"</span><span>, </span><span class="nonlocalVariableHighlighting">sf</span><span>, </span><span class="nonlocalVariableHighlighting">power</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>        fprintf(</span><span class="nonlocalVariableHighlighting">br</span><span>)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre;"><span>    </span><span style="color: rgb(0, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(0, 0, 255);">end</span></span></div></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
function [accelTorque, decelTorque, torqueRMS] = calculate(mt)
%% CALCULATE *Calculations script for motors coursework*
% *Takes input in form of motors table to select most sutable motor*
% 
% USE: Use load("motorsTable.mat") before running the script, and pass it as 
% an input. If selecting a motor, comment out line 37 through 78.
% 
% To calculate torque requirements of system based on inertia, comment out line 
% 2!
% 
% _Callum Morrison, 2019_
% 
% 
%% VARIABLES
% INERTIA
% Rotors
% D, d / m
% m / kg
% Driving roller radius
r = 0.075;
% Driving Roller
D(1) = 0.15;
d(1) = 0.15; %% Same as D if unknown
m(1) = 3.57;
% Driven Roller
D(2) = 0.15;
d(2) = 0.15; %% Same as D if unknown
m(2) = 3.57;
% Tension Roller
D(3) = 0.1;
d(3) = 0.1; %% Same as D if unknown
m(3) = 2.04;
% 
% Linear momentum
% mL / kg
% Belt
mL(1) = 25.48;
% Box full
mL(2) = 7.645;
% Box empty
% mL(2) = 0.545;
% 
% Gear ratios for two stage gearbox
% Stage 1 (closest to motor)
gr1 = 4.71;
% Stage 2 (closest to output shaft)
gr2 = 4.5;
% Gear ratio (overall)
gr =  gr1 * gr2;
%% 
% 
% Constant sources of inertia (gearbox, bearings, pulleys etc)
% Divide as necessary by gear ratios *squared* to determine inertia seen by 
% motor!
% Key:
% ST0   |   Inertia at motor; not affected by gear ratio
% ST1   |   Inertia after stage 1; affected by gr1 only
% ST2   |   Inertia after stage 2; affected by gt1 and gr2 (total gear ratio)
% iC / kgm^2
% ST0 | Stage 1 Driving Pulley
iC(1) = 2.92e-7;
% ST1 | Stage 1 Driven Pulley
iC(2) = 4.25e-5 / gr1^2;
% ST1 | Stage 2 Driving Pulley
iC(3) = 1.12e-6 / gr1^2;
% ST2 | Stage 2 Driven Pulley
iC(4) = 2.37e-4 / gr^2;
% ST2 | 12mm Output Shaft
iC(5) = 5.59e-6 / gr^2;
% ST1 | 6-8mm Intermediate Shaft
iC(6) = 1.85e-7 / gr1^2;
% ST1 | 6mm Ball Bearing
iC(7) = 6.48e-8 / gr1^2;
% ST1 | 8mm Ball Bearing
iC(8) = 1.92e-7 / gr1^2;
% ST2 | 12mm Ball Bearing
iC(9) = 5.10e-7 / gr^2;
% ST0 | 3mm Timing Belt
iC(10) = 3.87e-5;
% ST1 | 5mm Timing Belt
iC(11) = 1.84e-4 / gr1^2;
% ST0 | Motor
iC(12) = 3.67e-4;
%% 
% FRICTION
% Constant linear
% f / N
% Belt
f(1) = 250;
% 
% Constant rotary
% tC / Nm
% Nothing here
% 
% VELOCITY PROFILE
% Max speed of driving rotor v = r * omega
linmax = 1; % v       % ms^-1
% Distance required to travel cycle length / m
travelDist = 1.5;
% Acceleration time / s
accelTime = 0.75;
% Deceleration time / s
decelTime = 0.75;
%% 
% 
% REPLACE_WITH_DASH_DASH- DO NOT EDIT REPLACE_WITH_DASH_DASH-
% Calculates distance traveled while accelerating and decelerating
variableSpeedDist = (linmax / 2 * accelTime) + (linmax / 2 * decelTime);
% Calculates time required at max speed to reach travel dist
timeConstSpeed = (travelDist - variableSpeedDist) / linmax;
vmaxrad = linmax / r; % omega            % rads^-1
vmax = vmaxrad * 60 / (2 * pi());        % rpm
clear linmax
% Time variables in the form
% [startAccel, stopAccel, startDecel, stopDecel]
% Assumes trapezoidal profile!
t = [0 accelTime accelTime + timeConstSpeed accelTime + timeConstSpeed + decelTime];
% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
% 
% SAFETY FACTOR
% Design safety factor
sf = 1.3;
% 
% TRANSMISSION EFFICIENCY
% Mechanical efficiency of the transmission from 0-1 (0% to 100% efficient)
mechEfficiency = 0.95*0.95;
%% 
% 
%% END OF VARIABLES
% 
% 
% 
% Output separator
sz = get(0, 'CommandWindowSize');
br = "\n" + join(repmat("-", sz(1), 1), "") + "\n\n";
clear sz
fprintf(br)
% 
% Check for input table
if ~exist("mt", "var")
    fprintf("No motors table detected, skipping straight to inertia calculations! " + ...
        "If this is not desired, please use form 'calculate(motorsTable)' \n")
    
    skipMotors = 1;
else
    skipMotors = 0;
end
% 
% Initialise nested variables
inertiaAtMotor = 0;
constTorque = 0;
power = 0;
% 
% Calculate gear ratio for all motors
if ~exist("gr", "var")
    
    if skipMotors
        error("No motors table has been supplied - you must provide gear ratio")
    end
    
    fprintf("Gear ratio has not been supplied... calculating based on max motor RPM\n")
    
    grSupplied = 0;
    
    fprintf("Calculating required motor gear ratios\n")
    gr = mt.("rpm") ./ vmax;
    fprintf("Done!\n")
end
fprintf(br)
% 
% Convert inertia for all motors
if ~skipMotors
    fprintf("Converting motor table inertia from kgcm^2 to kgm^2... \n")
    mt.("inertia")(:) = mt.("inertia")(:) / 10000;
    fprintf("Done!\n")
    
    fprintf(br)
end
% 
% Basic Power Calculation
powerCalc
% 
% Motor Selection
if ~skipMotors
    motorSuitable = zeros(height(mt), 1);
    
    % Loop through all motors
    for x = 1:height(mt)
        
        fprintf("Testing motor %d\n", x)
        
        motorPower(x) = mt.("rpm")(x) * 2 * pi() / 60 * mt.("torqueStall")(x);
        
        fprintf("Using motor speed of %.0frpm \n", mt.("rpm")(x))
        fprintf("Using motor stall torque of %.2fNm \n", mt.("torqueStall")(x))
        
        if motorPower(x) > power
            fprintf("SUCCESS: Motor (%dW) IS more powerful than required power %dW \n", round(motorPower(x)), power)
            motorSuitable(x) = 1;
            
            fprintf(br)
            
        elseif motorPower(x) <= power
            fprintf("ERROR: Motor (%dW) IS NOT powerful enough (required %dW) \n", round(motorPower(x)), power)
            motorSuitable(x) = 0;
            
            fprintf(br)
            
        end
    end
    
    if motorSuitable ~= 1
        error("No suitable motors!")
    end
    
    fprintf("%d motors are suitable from the table of %d\n", sum(motorSuitable), height(mt))
    
    fprintf(br)
%% 
% 
% Gearbox Calculations
    fprintf("WARNING!\n")
    
    fprintf("Gear ratio was not supplied in variables\n")
    fprintf("The function will now end\n")
    fprintf("Please select a suitable gearbox and related components, and populate variables\n")
    
    fprintf(br)
    
    fprintf("For reference, power transmission requirement is %dW\n", power)
    fprintf("Remember: REAL GEAR RATIO MUST BE LESS THAN OR EQUAL TO THAT STATED HERE\n")
    fprintf("In this case, the motor will just run slightly slower than full speed to reach target belt velocity\n")
    fprintf("Gear ratios for suitable motors are as follows:\n")
    fprintf("   MOTOR POWER / W    GR          Frq\n")
    
    % Selects only gear ratios of suitable motors
    gearRatios = round(gr(find(motorSuitable)));
    
    % Displays gear ratios alongside their motor's power and frequency of
    % gr
    disp([transpose(round(motorPower(find(motorSuitable)))), gearRatios, transpose(sum(gearRatios==gearRatios'))]);
    
    fprintf("It is recommended you select gear ratios for motors with the lowest power; in order to prevent over-design\n")
    
    error("Function finished successfully")
end
% 
% Inertia Calculations
inertiaCalc
%% 
% 
% Calculate non-steady state torque
% Constant torque due to friction is assumed to be 100% at any speed - as this 
% is worst case scenario
fprintf("Assume constant torque %dNm is 100%% at any speed!\n\n", constTorque)
fprintf("Using inertia at motor as %dkgm^2\n", inertiaAtMotor)
fprintf("Mechanical efficiency is set as %d", mechEfficiency)
fprintf(br)
% Convert constant torque to torque on side of motor
constTorque = constTorque / gr;
% Convert max vmaxrad from after transmission to before transmission (same
% side as motor)
vmaxrad = vmaxrad * gr;
% Convert vmax from after transmission to before transmission
vmax = vmax * gr;
% Case 1: Acceleration
dt = t(2) - t(1);
fprintf("Acceleration: change in angular velocity of %drads^-1 in %ds \n", vmaxrad, dt)
accelTorque = (constTorque + inertiaAtMotor * (vmaxrad / dt)) / mechEfficiency;
fprintf("Required acceleration torque calculated as %dNm \n", accelTorque)
fprintf(br)
% Case 2: Deceleration
dt = t(4) - t(3);
fprintf("Deceleration: change in angular velocity of -%drads^-1 in %ds \n", vmaxrad, dt)
decelTorque = (constTorque + inertiaAtMotor * (-vmaxrad / dt)) / mechEfficiency;
fprintf("Required deceleration torque calculated as %dNm \n", decelTorque)
fprintf(br)
% 
% Calculate RMS Torque
% Calculate RMS torque, where Tcycle = t(4)
torqueRMS = sqrt(1 / t(4) * (t(2) * accelTorque^2 + (t(3) - t(2)) * constTorque^2 + (t(4) - t(3)) * decelTorque ) );
fprintf("RMS Torque calculated as %d\n", torqueRMS)
fprintf(br)
%% 
% 
% Plot motor speed against torque requirements
hold on
yyaxis left
plot(t, [0 vmax vmax 0])
ylabel("Motor Speed / rpm")
yyaxis right
xlim([t(1) t(end)])
ylim([min([accelTorque, constTorque, decelTorque, torqueRMS, 0]) * 1.1, max([accelTorque, constTorque, decelTorque, torqueRMS]) * 1.1])
line([t(2), t(2)], [get(gca, "YLim")], 'Color', '#333333', 'LineStyle','-.', 'HandleVisibility','off')
line([t(3), t(3)], [get(gca, "YLim")], 'Color', '#333333', 'LineStyle','-.', 'HandleVisibility','off')
plot([t(1) t(2) t(2) t(3) t(3) t(4)], [accelTorque accelTorque constTorque constTorque decelTorque decelTorque])
plot([0, t(end)], [torqueRMS, torqueRMS], "r")
legend(["Motor Speed / rpm", "Required Torque / Nm", "RMS Torque / Nm"])
xlabel("time / s")
ylabel("Motor Torque / Nm")
grid minor
%% 
%% NESTED FUNCTIONS
% Inertia Calculations
    function inertiaCalc
        inertia = [];
        
        %% Constant for all motors and gear ratios
        % For rotors
        if exist('D','var')
            for x = 1:1:size(D,2)
                fprintf("Rotor no. " + x + " uses variables:\n")
                fprintf("D = %d \n", D(x))
                fprintf("d = %d \n", d(x))
                fprintf("m = %d \n", m(x))
                
                % 'inertia' variable is affected by gearbox
                inertia(x) = inertiaRotor(D(x), d(x), m(x));
                
                fprintf("Inertia for rotor %d was calculated as %d kgms^2\n", x, inertia(x))
                
                fprintf(br)
            end
        else
            fprintf("No rotors detected... continuing\n")
            
            fprintf(br)
        end
        
        
        % For linear inertia
        if exist('mL','var')
            for x = 1:1:size(mL,2)
                fprintf("Linear 'inertia' source found: m = " + mL(x) + "kg\n")
                fprintf("Using driving radius: %d\n", r)
                fprintf("Converting to inertia: I = %.2dkgms^2\n", mL(x) * r^2)
                
                fprintf(br)
                
                % Approximate linear inertia as point mass at driven roller radius
                % I = mr^2
                % 'inertia' variable is affected by gearbox
                
                inertia = [inertia, mL(x) * r^2];
            end
        else
            fprintf("No linear 'inertia' sources detected... continuing\n")
            
            fprintf(br)
        end
        
        
        % Calculate inertia before and after bearbox (just noticed this misspelling but I'm keeping it)
        fprintf('Converting inertia after gearbox to inertia before gearbox...\n')
        inertia = sum(inertia);
        fprintf('Total inertia after gearbox (opposite side to motor) calculated as %dkgm^s\n', inertia)
        
        fprintf(br)
        
        inertiaAtMotor = inertia / gr^2;
        
        % Additional inertia sources (i.e. transmission inertia)
        if exist('iC','var')
            for x = 1:1:size(iC,2)
                fprintf("Constant inertia source found: i = %d kgms^2 \n", iC(x))
                fprintf('This will not be affected by gear ratio!\n')
                fprintf('Ensure you have already divided by suitable gear ratios in the variables list!\n')
                
                inertiaAtMotor = inertiaAtMotor + iC(x);
                
                fprintf(br)
            end
        else
            fprintf("No constant inertia sources detected... continuing\n")
            fprintf(br)
        end
        
        fprintf("REPLACE_WITH_DASH_DASH- TOTAL INERTIA REPLACE_WITH_DASH_DASH-\n")
        fprintf("Total inertia at motor = %d kgms^2\n", inertiaAtMotor)
        
        fprintf(br)
        
    end
%% 
% Power Calculations
    function powerCalc
        % Check for constant linear friction, convert to torque
        
        constTorque = [];
        if exist('f', 'var')
            for x = 1:1:size(f,2)
                fprintf("Constant linear force found: f = " + f(x) + "N\n")
                
                constTorque(x) = linearToRotary(f(x),r(x));
                
                fprintf("Constant torque for constant force " + x + " was calculated as " + constTorque(x) + "Nm\n")
                
                fprintf(br)
            end
        else
            fprintf("No constant linear force detected... continuing\n")
            
            fprintf(br)
        end
        
        % Check for constant torque friction
        if exist('tC', 'var')
            for x = 1:1:size(tC,2)
                fprintf("Constant torque found: t = " + tC(x) + "Nm\n")
                
                constTorque = [constTorque, tC(x)];
                
                fprintf(br)
            end
        else
            fprintf("No constant linear force detected... continuing\n")
            
            fprintf(br)
        end
        
        % Throw error if no friction (power would be zero)
        if ~exist("constTorque","var")
            error("No constant torque calculated... something went wrong\n")
        end
        
        % Sum all torque values
        constTorque = sum(constTorque);
        
        % Calculate total power required.
        % Gear ratio is irrelevant here
        fprintf("Calculating power required to drive load\n")
        fprintf("Constant torque after gearbox (opposite side to motor) calculated as %.2dNm\n", constTorque)
        fprintf("Rotational velocity of load is %.2d rads^-1\n", vmaxrad)
        
        fprintf(br)
        
        power = vmaxrad * constTorque;
        fprintf("Initial required power = %.2fW \n", power)
        
        power = power * sf;
        
        fprintf("Using a safety factor of %.2f, motor power becomes %dW\n", sf, power)
        
        fprintf(br)
    end
end
##### SOURCE END #####
--></body></html>